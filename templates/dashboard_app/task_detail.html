{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“Œ ì‘ì—… ìƒì„¸ ë³´ê¸°</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <h1>ğŸ“Œ {{ task.title }}</h1>

  <ul>
    <li><strong>ë‹´ë‹¹ì:</strong> {{ task.assignee }}</li>
    <li><strong>ê¸°ê°„:</strong> {{ task.start_date }} ~ {{ task.end_date }}</li>
    <li><strong>ìƒíƒœ:</strong> {{ task.status }}</li>
    <li><strong>ìš°ì„ ìˆœìœ„:</strong> {{ task.priority }}</li>
    <li><strong>ì§„í–‰ë¥ :</strong> {{ task.progress }}%</li>
    <li><strong>ì™„ë£Œ:</strong> {% if task.is_done %}âœ…{% else %}âŒ{% endif %}</li>
  </ul>

  <div class="section">
    <h2>ğŸ“ ì„¸ë¶€ ë‚´ìš©</h2>
    <textarea id="desc-input">{{ task.description }}</textarea>
    <button onclick="updateDesc()">ì €ì¥</button>
  </div>

  <div class="section">
    <h2>ğŸ“‚ íšŒì˜ë¡</h2>
    {% if meeting_notes %}
      <ul>
        {% for note in meeting_notes %}
        <li>
          <div class="note-title" onclick="toggleNote('{{ note.id }}')">
            ğŸ“„ {{ note.created_at|date:"Y.m.d H:i" }} - {{ note.title }}
          </div>
          <div class="note-content" id="note-{{ note.id }}">
            <p>{{ note.content|linebreaksbr }}</p>
          </div>
        </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>íšŒì˜ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}
  </div>

  <script>
    function updateDesc() {
      const desc = document.getElementById('desc-input').value;
      const csrftoken = '{{ csrf_token }}';
      fetch(`/tasks/update/{{ task.id }}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken
        },
        body: JSON.stringify({
          field: 'description',
          value: desc
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert('ì„¤ëª…ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } else {
          alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      });
    }

    function toggleNote(id) {
      const el = document.getElementById('note-' + id);
      el.style.display = (el.style.display === 'none') ? 'block' : 'none';
    }
  </script>
</body>
</html>
